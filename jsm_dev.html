<!DOCTYPE HTML>
<html>
<head>
<title>js.metaret development example</title>
<meta charset="utf-8">
<style type="text/css">
body { max-width: 600px; margin: auto;  }
p, h1, h2, h3, h4 {
    font-family: Verdana,Arial,'Lucida Grande',Sans-Serif;
    line-height: 150%;
    text-align: justify;
}
h1, h2, h3 { margin-top: 3em; }
.anchor { margin-left: 0.5em; }
@media only screen { .screen-hidden, .print { display: none; } }
.happy { color: darkgreen; }
.sad { color: darkred; }

#scripts-display {width: 100%; height: 235px;}
</style>
</head>
<body>

<a href="https://github.com/glathoud/js.metaret">
  <img style="position: fixed; top: 0; right: 0; border: 0; margin: 0; padding: 0;"
       src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
       alt="Fork me on GitHub">
</a>

<pre><code><a href="index.html">article</a>    <strong>dev</strong>    <a href="jsm_out_build.html">test build</a>    <a href="jsm_out_mini.html">test mini</a></code></pre>

<h2>js.metaret development example</h2>

<p><code>need$</code> loads and executes individual <code>.js</code> and <code>.jsm</code> files (using <a href="jsm2js.js">jsm2js.js</a>).</p>

<p id="scripts">
<script type="text/javascript" src="need$.js"></script>
<script type="text/javascript">
  need$( "jsm_dev/expl.js" );
  need$( "jsm_dev/expl_basic.test.js" );
  need$( "jsm_dev/expl_longer.test.js" );

  var result;
  try {
      result = test();
  } catch (e) {
      console.log( "jsm_dev.html: caught error: " + e, e )
      result = e;
  }
</script>
</p>

<p>Example sources: <a href="jsm_dev">jsm_dev/</a></p>

<p>Test implementation:</p>
<textarea id="scripts-display" readonly="readonly"></textarea>
<script type="text/javascript">document.getElementById("scripts-display").value=document.getElementById("scripts").innerHTML;</script>

<p>Test result:</p>
<p id="result"></p>

<script type="text/javascript">
  document.getElementById("result").innerHTML = result === true 
    ? "\x3Cspan class='happy'\x3EAll tests passed.\x3C/span\x3E" 
    : ("\x3Cdiv class='sad'\x3E\x3Cp\x3ESome tests failed:\x3C/p\x3E" +
       "\x3Cpre\x3E\x3Ccode\x3E" + result + "\x3C/code\x3E\x3C/pre\x3E\x3C/div\x3E") 
  ;
</script>

<h2 id="production">Next step: production</h2>

<p>After development, use <code>jsm_build.py</code> to create a standalone <code>.js</code> file&nbsp;(*).</p>

<p>Usage (Python 3.2 or later + V8 version 3.19.10):</p>
<pre><code>./jsm_build.py expl.js 
# or equivalently:
./jsm_build.py jsm_dev/expl.js</code></pre>

<p>This creates 2 output files:</p>
<pre><code>jsm_out_build/expl.js</code> (readable) -> <a href="jsm_out_build.html">click to test the build (redable)</a>
<code>jsm_out_mini/expl.js</code>  (minified) -> <a href="jsm_out_mini.html">click to test the build (minified)</a>
</pre>

<hr/>
<p>(*) "Standalone" means that all dependencies have been eliminated:
<br>- each <code>need$()</code> replaced by the contents of the corresponding file.
<br>- each <code>metafun</code> &amp; <code>metaret</code> replaced by standard JavaScript.
<br>- each <code>inline</code> replaced by standard JavaScript.
</p>


<script type="text/javascript">
if (!/\d+\.\d+\.\d+\.\d+|localhost/.test( location.hostname ))
{
var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-5516483-1']);  _gaq.push(['_trackPageview']);  (function() {    var ga = document.createElement('script');    ga.src = ('https:' == document.location.protocol ? 'https://ssl' :         'http://www') + '.google-analytics.com/ga.js';    ga.setAttribute('async', 'true');    document.documentElement.firstChild.appendChild(ga);  })();
}
</script>

</body>
</html>
